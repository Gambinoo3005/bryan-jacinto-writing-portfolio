---
export interface Props {
  testimonials: Array<{
    id: string;
    name: string;
    role: string;
    company: string;
    avatar?: string;
    content: string;
    project?: string;
    results?: string;
  }>;
}

const { testimonials } = Astro.props;
---

<div class="testimonials-grid scroll-reveal">
  {testimonials.map((testimonial, index) => (
    <article 
      class={`testimonial-card scroll-reveal-item ${index > 0 ? `scroll-reveal-delay-${Math.min(index, 3)}` : ''}`}
    >
      <div class="card-content">
        <!-- Top: Quote Icon -->
        <div class="quote-icon-wrapper">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="quote-icon">
            <path d="M9.983 3v7.391c0 5.704-3.731 9.57-8.983 10.609l-.995-2.151c2.432-.917 3.995-3.638 3.995-5.849h-4v-10h9.983zm14.017 0v7.391c0 5.704-3.748 9.571-9 10.609l-.996-2.151c2.433-.917 3.996-3.638 3.996-5.849h-3.983v-10h9.983z" />
          </svg>
        </div>

        <!-- Middle: Testimonial Content -->
        <blockquote class="testimonial-quote">
          <p>"{testimonial.content}"</p>
        </blockquote>

        <!-- Bottom: Client Info -->
        <footer class="card-footer">
          <div class="avatar-wrapper">
            {testimonial.avatar ? (
              <img 
                src={testimonial.avatar} 
                alt={testimonial.name}
                class="avatar-image"
                loading="lazy"
                width="64"
                height="64"
              />
            ) : (
              <div class="avatar-placeholder">
                <span class="avatar-initials">
                  {testimonial.name.split(' ').map(n => n[0]).join('').slice(0, 2)}
                </span>
              </div>
            )}
          </div>
          
          <div class="client-info">
            <h3 class="client-name">{testimonial.name}</h3>
            <p class="client-role">{testimonial.role}</p>
            <p class="client-company">{testimonial.company}</p>
          </div>
        </footer>
      </div>
    </article>
  ))}
</div>

<style>
  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 2rem;
    width: 100%;
  }

  @media (min-width: 768px) {
    .testimonials-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .testimonials-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .testimonial-card {
    background: var(--card-bg); /* Use existing system card background */
    border: 1px solid color-mix(in srgb, var(--color-border) 80%, transparent);
    border-radius: 1rem;
    padding: 2.5rem 2rem;
    text-align: center;
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  }

  .testimonial-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
  }

  .card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    height: 100%;
  }

  /* Quote Icon */
  .quote-icon-wrapper {
    color: var(--color-accent); /* Use system accent color for the quote icon */
    opacity: 0.8;
  }
  
  .quote-icon {
    width: 32px;
    height: 32px;
  }

  /* Testimonial Text */
  .testimonial-quote {
    margin: 0;
    flex-grow: 1; /* Pushes footer down if cards differ in height */
  }

  .testimonial-quote p {
    font-size: 1.05rem;
    line-height: 1.6;
    color: var(--color-text);
    margin: 0;
  }

  /* Client Info Footer */
  .card-footer {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
  }

  .avatar-wrapper {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid var(--surface-glass); /* Subtle separation ring */
    box-shadow: 0 0 0 1px var(--color-border);
  }

  .avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface-glass);
    color: var(--color-text);
    font-weight: bold;
    font-size: 1.2rem;
  }

  .client-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .client-name {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-heading);
  }

  .client-role {
    margin: 0;
    font-size: 0.9rem;
    color: var(--color-muted);
    font-weight: 500;
  }

  .client-company {
    margin: 0;
    font-size: 0.85rem;
    color: var(--color-muted);
    opacity: 0.8;
  }

  @media (max-width: 640px) {
    .testimonial-card {
      padding: 2rem 1.5rem;
    }
    
    .quote-icon {
      width: 28px;
      height: 28px;
    }
  }
</style>
